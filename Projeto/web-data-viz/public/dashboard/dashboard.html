<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link rel="shortcut icon" href="../assets/icon/tracker.png" type="image/x-icon">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CiriacoTracker | Dashboards</title>
    <link rel="stylesheet" href="./../css/dashboards.css">
    <link rel="stylesheet" href="./../css/estilo.css" />
    <script src="../js/sessao.js"></script>
    <script src="./../js/alerta.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@200;300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://kit.fontawesome.com/9f7414eb10.js" crossorigin="anonymous"></script>
</head>

<body>

    <div class="janela">

        <div class="header-left">
            <h1><img src="../assets/imgs/logoPrincipal.png" width="250"></h1>
            <div class="btn-nav">
                <h3>Gráficos</h3>
            </div>

            <div class="btn-nav-white">
                <a href="./mural.html">
                    <h3>Questionário</h3>
                </a>
            </div>

            <div class="btn-logout" onclick="limparSessao()">
                <h3>Sair</h3>
            </div>
        </div>

        <div class="dash">



            <div class="btns-dash" id="areaFiltros"></div>
            <div class="kpi-cards">
                <div class="card">
                    <h3>Total de Abates</h3>
                    <p id="kpi_abates">--</p>
                </div>

                <div class="card">
                    <h3>Total de Mortes</h3>
                    <p id="kpi_mortes">--</p>
                </div>

                <div class="card">
                    <h3>KDA</h3>
                    <p id="kpi_kda">--</p>
                </div>

                <div class="card">
                    <h3>Taxa de Vitória</h3>
                    <p id="kpi_winrate">--</p>
                </div>
            </div>

            <div id="dashboard">
                <h1>Meus gráficos</h1>

                <div class="charts-wrapper">

                    <div class="chart-container">
                        <h2>Abates</h2>
                        <canvas id="temperatureChart"></canvas>
                    </div>

                    <div class="chart-container-horary">
                        <h2>Partidas Jogadas</h2>
                        <canvas id="horaryChart"></canvas>
                    </div>

                </div>
            </div>

        </div>
    </div>
    </div>

    </div>

</body>




<script>
    fetch(`/estatisticas/abates/${sessionStorage.ID_USUARIO}`)
  .then(res => res.json())
  .then(dados => {
    let labels = dados.map((_, index) => `Partida ${index + 1}`);
    let valores = dados.map(v => v.abates);

    const ctx = document.getElementById('temperatureChart');

    new Chart(ctx, {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: 'Abates',
          data: valores,
          borderWidth: 3,
          borderColor: '#FF4655',
          backgroundColor: 'rgba(255, 70, 85, 0.2)',
          fill: true,
          tension: 0.4,
          pointRadius: 6,
          pointHoverRadius: 9,
          pointBackgroundColor: 'white',
          pointBorderColor: '#FF4655',
        }]
      }
    });
  });




    fetch(`/estatisticas/resumo/${sessionStorage.ID_USUARIO}`)
        .then(res => res.json())
        .then(dados => {

            let vitorias = dados.totalVitorias;
            let derrotas = dados.totalPartidas - dados.totalVitorias;

            const ctx2 = document.getElementById('horaryChart');

            new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: ['Vitória', 'Derrota'],
                    datasets: [{
                        data: [vitorias, derrotas],
                        backgroundColor: ['#FF4655', '#e3b062'],
                        hoverBackgroundColor: ['#FF758F', '#EDC07A']
                    }]
                }
            });
        });
    fetch(`/estatisticas/resumo/${sessionStorage.ID_USUARIO}`)
        .then(res => res.json())
        .then(dados => {

            document.getElementById("kpi_abates").innerText = dados.totalAbates;
            document.getElementById("kpi_mortes").innerText = dados.totalMortes;
            document.getElementById("kpi_kda").innerText = dados.kda || "0.00";

            let winrate = ((dados.totalVitorias / dados.totalPartidas) * 100).toFixed(1);
            document.getElementById("kpi_winrate").innerText = winrate + "%";

        })
        .catch(erro => {
            console.error("Erro ao buscar KPIs:", erro);
        });

</script>

</html>